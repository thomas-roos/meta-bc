Fix SOCI rvalue reference errors in main-db.cpp

SOCI library doesn't accept rvalue references (temporaries) in soci::use().
Store values in variables before passing to soci::use().

Upstream-Status: Pending

diff --git a/src/db/main-db.cpp b/src/db/main-db.cpp
index 50e12f3..eb0284a 100644
--- a/src/db/main-db.cpp
+++ b/src/db/main-db.cpp
@@ -1828,8 +1828,9 @@ void MainDbPrivate::updateConferenceChatMessageEvent(const shared_ptr<EventLog>
 		static const string query =
 		    "SELECT chat_message_participant.state FROM chat_message_participant WHERE event_id = :eventId AND "
 		    "chat_message_participant.participant_sip_address_id = :meAddressId";
+		long long storageId = chatMessage->getStorageId();
 		soci::rowset<soci::row> rows =
-		    (session->prepare << query, soci::use(chatMessage->getStorageId()), soci::use(meAddressId));
+		    (session->prepare << query, soci::use(storageId), soci::use(meAddressId));
 		ChatMessage::State meParticipantState = ChatMessage::State::Idle;
 		for (const auto &row : rows) {
 			meParticipantState = static_cast<ChatMessage::State>(row.get<int>(0));
@@ -1852,6 +1853,7 @@ void MainDbPrivate::updateConferenceChatMessageEvent(const shared_ptr<EventLog>
 		                            " FROM sip_address, chat_message_participant"
 		                            " WHERE event_id = :eventId"
 		                            " AND sip_address.id = chat_message_participant.participant_sip_address_id";
+		long long storageId = chatMessage->getStorageId();
 		soci::rowset<soci::row> rows = (session->prepare << query, soci::use(chatMessage->getStorageId()));
 
 		// Use list of participants the client is sure have received the message and not the actual list of participants
@@ -4982,6 +4984,7 @@ list<shared_ptr<ChatMessage>> MainDb::getEphemeralMessages() const {
 		L_D();
 		list<shared_ptr<ChatMessage>> chatMessages;
 		auto epoch = d->dbSession.getTimeWithSociIndicator(0);
+		int maxNb = EPHEMERAL_MESSAGE_TASKS_MAX_NB;
 		soci::rowset<soci::row> rows =
 		    getBackend() == MainDb::Backend::Sqlite3
 		        ? (d->dbSession.getBackendSession()->prepare << query, soci::use(epoch.first),
@@ -5757,6 +5760,8 @@ list<shared_ptr<EventLog>> MainDb::getHistoryRangeNear(const ConferenceId &confe
 			const long long &dbEventId = dEventKey->storageId;
 
 			soci::rowset<soci::row> rows = (d->dbSession.getBackendSession()->prepare << query, soci::use(dbChatRoomId),
+			unsigned int beforePlusOne = before + 1;
+			unsigned int afterPlusOne = after + 1;
 			                                soci::use(dbEventId), soci::use(before + 1), soci::use(after + 1));
 
 			for (const auto &row : rows) {
